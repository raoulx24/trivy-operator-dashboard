using k8s;
using k8s.Models;
using TrivyOperator.Dashboard.Application.Services.Abstractions;
using TrivyOperator.Dashboard.Domain.Trivy.VulnerabilityReport;
using TrivyOperator.Dashboard.Infrastructure.Abstractions;

namespace TrivyOperator.Dashboard.Application.Services;

public class KubernetesVulnerabilityReportCrWatchEventHandler(IConcurrentCache<string, DateTime> cache)
    : IKubernetesVulnerabilityReportCrWatchEventHandler
{
    public Task Handle(WatchEventType type, VulnerabilityReportCR item)
    {
        string key = $"vulenrabilityreportcr.{item.Metadata.Namespace()}";
        cache[key] = DateTime.UtcNow;
        return Task.CompletedTask;
    }
}
