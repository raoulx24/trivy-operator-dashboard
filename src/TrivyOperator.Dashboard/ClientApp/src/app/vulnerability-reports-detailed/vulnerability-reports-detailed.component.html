<h3 id="tableLabel">Vulnerability Reports Detailed</h3>

<p-tag [value]="getSeverityCssColor(1)" [style]="{ background: getSeverityCssColor(1) }" />
<!--</p-tag>-->

<p *ngIf="!vulnerabilityReportsDetailedDtos"><em>Loading...</em></p>

<!--<ag-grid-angular (gridReady)="onGridReady($event)"
                  *ngIf="vulnerabilityReportsDetailedDtos"
                  [columnDefs]="columnDefs"
                  [defaultColDef]="defaultColDef"
                  [rowData]="vulnerabilityReportsDetailedDtos"
                  [rowSelection]="rowSelection"
                  class="ag-theme-quartz-auto-dark"
                  style="height: 30vh;">
</ag-grid-angular>-->

<p>{{ selectedTest }}</p>
<div *ngIf="severityDtos">
  <p-multiSelect [options]="testDropdown"
                 [(ngModel)]="selectedTest"
                 placeholder="Select Somethin"
                 [style]="{'width':'400px', 'font-size':'14px'}"
                 [filter]="false"
                 [showToggleAll]="false"
                 [showHeader]="false">
    <ng-template let-plix pTemplate="selectedItems">
      <div *ngIf="!plix || plix.length === 0">Select Severities</div>
      <div>{{ getSeverityCssColors(plix, 1) }}</div>
    </ng-template>
    <ng-template let-something pTemplate="item" [style]="{'font-size':'14px'}">
      <div [style]="{'font-size':'14px'}" class="flex align-items-center gap-2">{{ something }}-{{ getSeverityCssColor(something) }}</div>
    </ng-template>
  </p-multiSelect>
</div>
<!--<p-multiSelect [options]="test"
               [(ngModel)]="selectedTest"
               placeholder="Select Somethin'"
               [style]="{'width':'500px'}"
               [maxSelectedLabels]="2">
</p-multiSelect>-->

<p-table [value]="vulnerabilityReportsDetailedDtos!"
         [scrollable]="true"
         scrollHeight="400px"
         [virtualScroll]="true"
         [virtualScrollItemSize]="46"
         [tableStyle]="{ 'font-size': '14px' }"
         [resizableColumns]="true"
         columnResizeMode="expand"
         [reorderableColumns]="true"
         styleClass="p-datatable-sm"
         sortMode="multiple"
         [autoLayout]="true"
         selectionMode="multiple"
         [(selection)]="selectedVulnerabilityReportsDetailedDtos" 
         [metaKeySelection]="metaKey" 
         dataKey="uid">
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="resourceNamespace" pResizableColumn style="width: 130px; max-width: 130px;">
        NS
        <p-sortIcon field="resourceNamespace" />
        <p-columnFilter style="font-size:14px;" type="text" field="resourceNamespace" display="menu" />
      </th>
      <th pSortableColumn="resourceContainerName" pResizableColumn style="width: 170px; max-width: 170px;">
        Container
        <p-sortIcon field="resourceContainerName" />
        <p-columnFilter type="text" field="resourceContainerName" display="menu" />
      </th>
      <th pResizableColumn style="width: 330px; max-width: 330px;">
        Image Name - Tag
        <p-columnFilter type="text" field="imageName" display="menu" />
      </th>
      <th pSortableColumn="severityId" pResizableColumn style="width: 100px; max-width: 100px;">
        Sev
        <p-sortIcon field="severityId" />
        <p-columnFilter field="severityId" matchMode="in" display="menu" [showMatchModes]="false" [showOperator]="false" [showAddButton]="false">
          <ng-template pTemplate="filter" let-filter="filterCallback">

            <p-multiSelect [(ngModel)]="selectedTest"
                           [options]="testDropdown"
                           placeholder="Any"
                           (onChange)="filter($event.value)"
                           optionLabel="name"
                           [style]="{'font-size':'14px'}"
                           [filter]="false"
                           [showToggleAll]="false"
                           [showHeader]="false">
              <ng-template let-plix pTemplate="selectedItems">
                <div>{{ getSeverityCssColors(plix, 1) }}</div>
              </ng-template>
              <ng-template let-option pTemplate="item">
                <div [style]="{'font-size':'14px'}" class="flex align-items-center gap-2">{{ getSeverityName(option) }}</div>
              </ng-template>
            </p-multiSelect>

          </ng-template>
        </p-columnFilter>
      </th>
      <th pResizableColumn>Tiltle</th>
      <th pResizableColumn style="width: 150px; max-width: 150px; ">CVE</th>
    </tr>
    <!--<tr>
      <th>
        <p-columnFilter type="text"
                        field="resourceNamespace"
                        placeholder="Search by Namespace"
                        ariaLabel="Filter Name"
                        [style]="{'font-size':'14px'}" />
      </th>
      <th>
        <p-columnFilter type="text"
                        field="resourceContainerName"
                        placeholder="Search by Container"
                        ariaLabel="Filter Name"
                        [style]="{'font-size':'14px'}" />
      </th>
      <th>
        <p-columnFilter type="text"
                        field="imageName"
                        placeholder="Search by Image Name"
                        ariaLabel="Filter Name"
                        [style]="{'font-size':'14px'}" />
      </th>
      <th>
        <p-columnFilter type="text"
                        field="severityId"
                        placeholder="Search by Severity"
                        ariaLabel="Filter Name"
                        [style]="{'font-size':'14px'}" />
      </th>
      <th>
        <p-columnFilter type="text"
                        field="title"
                        placeholder="Search by Title"
                        ariaLabel="Filter Name"
                        [style]="{'font-size':'14px'}" />
      </th>
      <th>
        <p-columnFilter type="text"
                        field="vulnerabilityId"
                        placeholder="Search by CVE"
                        ariaLabel="Filter Name"
                        [style]="{'font-size':'14px'}" />
      </th>
    </tr>-->
  </ng-template>
  <ng-template pTemplate="body" let-vrdDto let-rowIndex="rowIndex">
    <tr style="height:46px" [pSelectableRow]="vrdDto" [pSelectableRowIndex]="rowIndex">
      <td style="width: 130px; max-width: 130px; ">{{ vrdDto.resourceNamespace }}</td>
      <td style="width: 170px; max-width: 170px; ">{{ vrdDto.resourceContainerName }}</td>
      <td style="width: 330px; max-width: 330px; ">{{ vrdDto.imageName }}:{{ vrdDto.imageTag }}</td>
      <td style="width: 100px; max-width: 100px; "><p-tag [value]="getSeverityShortName(vrdDto.severityId)" [style]="{ background: getSeverityCssColor(vrdDto.severityId) }" /></td>
      <!--<td>{{ vrdDto.severityId }}</td>-->
      <td style="white-space: normal;">{{ vrdDto.title }}</td>
      <td style="width: 150px; max-width: 150px; "><a href="{{ vrdDto.primaryLink }}" target="_blank">{{ vrdDto.vulnerabilityId }}</a></td>
    </tr>
  </ng-template>
  <!--<ng-template pTemplate="summary">
    <div>
      Total of Vulnerability Report Details {{vulnerabilityReportsDetailedDtos ? vulnerabilityReportsDetailedDtos.length : 0 }}.
    </div>
  </ng-template>-->
  </p-table>

  <div style="margin: 10px 0;">
    <button type="button" class="btn btn-primary" (click)="onBtnExport()">Download CSV export file</button>
  </div>
