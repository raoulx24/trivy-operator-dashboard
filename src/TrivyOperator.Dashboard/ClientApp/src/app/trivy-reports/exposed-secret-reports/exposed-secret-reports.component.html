<app-generic-master-detail [activeNamespaces]="activeNamespaces"
                           [dataDtos]="dataDtos"
                           [detailsTableColumns]="detailsTableColumns"
                           [isMainTableLoading]="isMainTableLoading"
                           [mainTableColumns]="mainTableColumns"
                           [singleSelectDataDto]="selectedTrivyReportDto"
                           [splitterStorageKey]="'Exposed Secret Reports'"
                           (mainTableExpandCallback)="onMainTableExpandCallback($event)"
                           (refreshRequested)="onRefreshRequested($event)"
                           (mainTableMultiHeaderActionRequested)="onMainTableMultiHeaderActionRequested($event)"
                           (mainTableSelectedRowChanged)="onMainTableSelectedRowChanged($event)"

                           [mainTableRowExpandResponse]="rowExpandResponse"
                           (mainTableRowExpandChange)="onRowExpandChange($event)"

                           [mainTableIsRefreshVisible]="!isSingleMode"
                           [mainTableIsRefreshFilterable]="!isSingleMode"
                           [mainTableSelectionMode]="'single'"
                           [mainTableStyle]="{ width: '645px' }"
                           [mainTableStateKey]="'Exposed Secret Reports - Main'"
                           [mainTableDataKey]="'uid'"
                           [mainTableRowExpansionRender]="'table'"
                           [mainTableExtraClasses]="'trivy-half'"
                           [mainTableMultiHeaderActions]="[
                             { label: '', icon: 'pi pi-align-justify', specialAction: 'Go to Detailed â§‰' },
                             { label: 'Compare with...', icon: 'pi pi-copy', enabledIfRowSelected: true },
                             { label: 'Dependency tree', icon: 'pi pi-sitemap', enabledIfRowSelected: true },
                             { label: '', specialAction: 'Clear Sort/Filters' },
                             { label: '', specialAction: 'Collapse All' }
                           ]"

                           [detailsIsResetFiltersVisible]="true"
                           [detailsStateKey]="'Exposed Secret Reports - Details'"
                           [detailsExtraClasses]="'trivy-half'" />

@if (mainTableExpandCallbackDto && mainTableExpandCallbackDto.resources) {
  <p-dialog closable="true"
            closeOnEscape="true"
            dismissableMask="true"
            resizable="true"
            [breakpoints]="{ '890px': '90vw' }"
            [contentStyle]="{ height: '60vh' }"
            [header]="getPanelHeaderText()"
            [modal]="true"
            [style]="{ width: '50rem' }"
            [(visible)]="isImageUsageDialogVisible" >
    <p-table scrollHeight="flex"
             sortMode="multiple"
             class="p-datatable-sm text-sm p-0"
             [scrollable]="true"
             [value]="mainTableExpandCallbackDto!.resources!" >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name" style="width: 55%">
            Resource Name
            <p-sortIcon field="name" />
          </th>
          <th pSortableColumn="kind" style="width: 20%">
            Kind
            <p-sortIcon field="kind" />
          </th>
          <th pSortableColumn="containerName" style="width: 25%">
            Container
            <p-sortIcon field="containerName" />
          </th>
        </tr>
      </ng-template>
      <ng-template let-resource pTemplate="body">
        <tr>
          <td style="width: 55%">
            {{ resource.name }}
          </td>
          <td style="width: 20%">
            {{ resource.kind }}
          </td>
          <td style="width: 25%">
            {{ resource.containerName }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-dialog>
}

@if (selectedTrivyReportDto && isTrivyReportsCompareVisible) {
  <p-dialog closable="true"
            closeOnEscape="true"
            dismissableMask="true"
            resizable="true"
            maximizable="true"
            [breakpoints]="{ '890px': '90vw' }"
            [contentStyle]="{ height: '95vh' }"
            header="Compare Exposed Secrets of Images"
            [modal]="true"
            [style]="{ width: '90vw' }"
            [(visible)]="isTrivyReportsCompareVisible" >
    <app-generic-reports-compare [dataDtos]="dataDtos"
                                 [comparedTableColumns]="comparedTableColumns"
                                 [namespacedImageDtos]="compareNamespacedImageDtos"
                                 [firstSelectedTrivyReportId]="compareFirstSelectedIdId"

                                 [compareIsResetFiltersVisible]="true"
                                 [compareStateKey]="'Exposed Secret Reports - Compared'"
                                 [compareExtraClasses]="'trivy-with-filters'" />
  </p-dialog>
}

@if (isDependencyTreeViewVisible && trivyImage) {
  <p-dialog closable="true"
            closeOnEscape="true"
            dismissableMask="true"
            resizable="true"
            maximizable="true"
            [breakpoints]="{ '890px': '90vw' }"
            [contentStyle]="{ height: '95vh' }"
            [header]="trivyDependencyDialogTitle"
            [modal]="true"
            [style]="{ width: '95vw' }"
            [(visible)]="isDependencyTreeViewVisible" >
    <app-trivy-dependency [trivyImage]="trivyImage" />
  </p-dialog>
}

