<app-generic-master-detail [activeNamespaces]="activeNamespaces"
                           [dataDtos]="dataDtos"
                           [detailsTableColumns]="detailsTableColumns"
                           [isMainTableLoading]="isMainTableLoading"
                           [mainTableColumns]="mainTableColumns"
                           [singleSelectDataDto]="singleSelectDataDto"
                           [splitterStorageKey]="'Vulnerability Reports'"
                           (mainTableExpandCallback)="onMainTableExpandCallback($event)"
                           (refreshRequested)="onRefreshRequested($event)"
                           (mainTableMultiHeaderActionRequested)="onMainTableMultiHeaderActionRequested($event)"
                           (mainTableSelectedRowChanged)="onMainTableSelectedRowChanged($event)"

                           [mainTableRowExpandResponse]="rowExpandResponse"
                           (mainTableRowExpandChange)="onRowExpandChange($event)"

                           [mainTableIsRefreshVisible]="!this.isSingleMode"
                           [mainTableIsRefreshFilterable]="!this.isSingleMode"
                           [mainTableSelectionMode]="'single'"
                           [mainTableStyle]="{ width: '645px' }"
                           [mainTableStateKey]="'Vulnerability Reports - Main'"
                           [mainTableDataKey]="'uid'"
                           [mainTableRowExpansionRender]="'table'"
                           [mainTableExtraClasses]="'trivy-half'"
                           [mainTableMultiHeaderActions]="[
                             { label: '', icon: 'pi pi-align-justify', specialAction: 'Go to Detailed â§‰' },
                             { label: 'Compare with...', icon: 'pi pi-copy', enabledIfRowSelected: true },
                             { label: 'Dependency tree', icon: 'pi-sitemap', enabledIfRowSelected: true },
                             { label: '', specialAction: 'Clear Sort/Filters' },
                             { label: '', specialAction: 'Collapse All' }
                           ]"

                           [detailsIsResetFiltersVisible]="true"
                           [detailsStateKey]="'Vulnerability Reports - Details'"
                           [detailsExtraClasses]="'trivy-half'" />

@if(mainTableExpandCallbackDto && mainTableExpandCallbackDto.resources) {
  <p-dialog closable="true"
            closeOnEscape="true"
            dismissableMask="true"
            resizable="true"
            [breakpoints]="{ '890px': '90vw' }"
            [contentStyle]="{ height: '60vh' }"
            [header]="getPanelHeaderText()"
            [modal]="true"
            [style]="{ width: '50rem' }"
            [(visible)]="isImageUsageDialogVisible" >
    <p-table scrollHeight="flex"
             sortMode="multiple"
             styleClass="p-datatable-sm text-sm p-0"
             [scrollable]="true"
             [value]="mainTableExpandCallbackDto!.resources!" >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name" style="width: 55%">
            Resource Name
            <p-sortIcon field="name" />
          </th>
          <th pSortableColumn="kind" style="width: 20%">
            Kind
            <p-sortIcon field="kind" />
          </th>
          <th pSortableColumn="containerName" style="width: 25%">
            Container
            <p-sortIcon field="containerName" />
          </th>
        </tr>
      </ng-template>
      <ng-template let-resource pTemplate="body">
        <tr>
          <td style="width: 55%">
            {{ resource.name }}
          </td>
          <td style="width: 20%">
            {{ resource.kind }}
          </td>
          <td style="width: 25%">
            {{ resource.containerName }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-dialog>
}

@if(selectedVulnerabilityReportDto) {
  <p-dialog closable="true"
            closeOnEscape="true"
            dismissableMask="true"
            resizable="true"
            maximizable="true"
            [breakpoints]="{ '890px': '90vw' }"
            [contentStyle]="{ height: '95vh' }"
            header="Compare Vulnerabilities of Images"
            [modal]="true"
            [style]="{ width: '90vw' }"
            [(visible)]="isVulnerabilityReportsCompareVisible" >
    <app-vulnerability-reports-compare [dataDtos]="dataDtos"
                                       [firstSelectedVulnerabilityReportId]="selectedVulnerabilityReportDto.uid ?? ''" />
  </p-dialog>
}


<p-dialog closable="true"
          closeOnEscape="true"
          dismissableMask="true"
          resizable="true"
          maximizable="true"
          [breakpoints]="{ '890px': '90vw' }"
          [contentStyle]="{ height: '95vh' }"
          [header]="trivyDependencyDialogTitle"
          [modal]="true"
          [style]="{ width: '95vw' }"
          [(visible)]="isDependencyTreeViewVisible" >
  <app-trivy-dependency [trivyImage]="trivyImage" />
</p-dialog>
