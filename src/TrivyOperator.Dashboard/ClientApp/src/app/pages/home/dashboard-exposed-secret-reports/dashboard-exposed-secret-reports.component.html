<div style="height: 78vh" class="row">
  <div class="grid grid-cols-12 gap-4 flex">
    <div class="col-span-12 lg:col-span-3 h-full">
      <h4 class="text-center">Exposed Secret Reports Statistics</h4>
      <div class="flex row">
        <p-table class="w-full p-datatable-sm text-sm" [value]="esTableSummary">
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 75%; max-width: 75%">Severity</th>
              <th style="width: 25%; max-width: 25%" class="tod-text-right">Count</th>
            </tr>
          </ng-template>
          <ng-template let-severity pTemplate="body">
            <tr>
              <td style="width: 75%; max-width: 75%">{{ severity.severityId | severityNameById }}</td>
              <td style="width: 25%; max-width: 25%" class="tod-text-right">{{ severity.count }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <div class="flex row mb-8 text-sm justify-end -ml-1">
        <p-button label="More on Exposed Secrets..." size="small" [text]="true" (onClick)="onEsrMore($event)" />
      </div>
    </div>

    <div class="hide-on-small lg:col-span-9 h-full justify-center">
      <p-carousel [autoplayInterval]="10000" [numScroll]="1" [numVisible]="1" [value]="slides">
        <ng-template let-slide pTemplate="item">
          <div class="custom-slide">
            @switch (slide) {
              @case ('nsByNs') {
                <h4 style="text-align: center">Exposed Secrets - Severity by Namespace</h4>
                @if (barchartDataNsByNs) {
                  <div class="flex justify-center">
                    <p-chart height="60vh"
                             type="bar"
                             width="60vw"
                             class="justify-center"
                             [data]="barchartDataNsByNs"
                             [options]="horizontalBarChartOption"
                    />
                  </div>
                }
              }
              @case ('nsBySev') {
                <h4 style="text-align: center">Exposed Secrets - Namespace by Severity</h4>
                @if (barchartDataNsBySev) {
                  <div class="flex justify-center">
                    <p-chart height="60vh"
                             type="bar"
                             width="60vw"
                             [data]="barchartDataNsBySev"
                             [options]="horizontalBarChartOption"
                    />
                  </div>
                }
              }
            }
          </div>
        </ng-template>
      </p-carousel>
    </div>
  </div>
</div>

<p-dialog closable="true"
          closeOnEscape="true"
          dismissableMask="true"
          header="Exposed Secret Reports Details"
          resizable="true"
          [contentStyle]="{ height: '70vh' }"
          [modal]="true"
          [style]="{ width: '90vw' }"
          [(visible)]="isMoreESDetailsModalVisible" >
  @if (exposedSecretReportSummaryDtos) {
    <div style="height: 65vh">
      <p-table class="p-datatable-sm text-sm" [scrollable]="true" [value]="namespaceNames">
        <ng-template pTemplate="header">
          <tr>
            <th pFrozenColumn>Namespace</th>
            @for (severityId of severityIds; track severityId) {
              <th class="tod-text-center">{{ severityId | severityNameById }}</th>
            }
          </tr>
        </ng-template>
        <ng-template let-item pTemplate="body">
          <tr>
            <td pFrozenColumn>{{ item }}</td>
            @for (severityId of severityIds; track severityId) {
              <td class="tod-text-center">
              <td class="tod-text-center w-36">
                @let result = getCountFromExposedSecretReportSummaryDtos(item, severityId);
                @if (result !== '0') {
                  <p-tag [rounded]="true"
                         [style]="severityId | severityCssStyleById"
                         [value]="result" />
                }
              </td>
            }
          </tr>
        </ng-template>
        <ng-template let-footerItem pTemplate="footer">
          <td pFrozenColumn class="font-bold p-2">Total</td>
          @for (severityId of severityIds; track severityId) {
            <td class="tod-text-center w-36">
              @let result = getCountFromExposedSecretReportSummaryDtos('', severityId);
              @if (result !== '0') {
                <p-tag [rounded]="true"
                       [style]="severityId | severityCssStyleById"
                       [value]="result" />
              }
            </td>
          }
        </ng-template>
      </p-table>
    </div>
  }
</p-dialog>
