<div style="height: 78vh" class="row">
  <div class="grid grid-cols-12 gap-4">
    <div class="col-span-12 lg:col-span-3 h-full">
      <span class="block text-center font-semibold">Vulnerability Reports Statistics</span>
      <div class="flex row">
        <p-table class="w-full p-datatable-sm text-sm" [value]="severitiesSummaryForTable">
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 50%; max-width: 50%">Severity</th>
              <th style="width: 25%; max-width: 25%" class="tod-text-right">Count</th>
              <th style="width: 25%; max-width: 25%" class="tod-text-right">Fixable</th>
            </tr>
          </ng-template>
          <ng-template let-severity pTemplate="body">
            <tr>
              <td style="width: 50%; max-width: 50%">{{ severity.severityName }}</td>
              <td style="width: 25%; max-width: 25%" class="tod-text-right">{{ severity.count }}</td>
              <td style="width: 25%; max-width: 25%" class="tod-text-right">{{ severity.fixable }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <div class="flex row mb-8 text-sm justify-end -ml-1">
        <p-button label="More on Severities..." size="small" [text]="true" (onClick)="onVrsMore($event)" />
      </div>
      <span class="block text-center font-semibold">Various Statistics</span>
      <div class="flex row mb-8">
        <p-table class="p-datatable-sm text-sm" class="w-full" [value]="othersSummaryForTable">
          <ng-template let-others pTemplate="body">
            <tr>
              <td style="width: 50%; max-width: 50%">{{ others.description }}</td>
              <td style="width: 25%; max-width: 25%" class="tod-text-right">{{ others.count }}</td>
              <td style="width: 25%; max-width: 25%">
                <div class="flex justify-end">
                  <p-button
                    label="More..."
                    size="small"
                    class="text-sm p-0"
                    [text]="true"
                    (onClick)="onOthersMore(others)"
                  />
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <div class="hide-on-small lg:col-span-9 h-full justify-center">
      <p-carousel [autoplayInterval]="10000" [numScroll]="1" [numVisible]="1" [value]="slides">
        <ng-template let-slide pTemplate="item">
          <div class="custom-slide">
            @switch (slide) {
              @case ('vrByNs') {
                <span class="block text-center font-semibold">Vulnerabilities by Namespace</span>
                @if (horizontalBarChartDataByNs) {
                  <div class="flex justify-center">
                    <p-chart height="60vh"
                             type="bar"
                             width="60vw"
                             class="justify-center"
                             [data]="horizontalBarChartDataByNs"
                             [options]="horizontalBarChartOption" />
                  </div>
                }
              }
              @case ('vrBySev') {
                <span class="block text-center font-semibold">Vulnerabilities by Severity</span>
                @if (horizontalBarChartDataByNs) {
                  <div class="flex justify-center">
                    <p-chart height="60vh"
                             type="bar"
                             width="60vw"
                             [data]="horizontalBarChartDataBySeverity"
                             [options]="horizontalBarChartOption" />
                  </div>
                }
              }
            }
          </div>
        </ng-template>
      </p-carousel>
    </div>
  </div>
</div>

<p-dialog closable="true"
          closeOnEscape="true"
          dismissableMask="true"
          header="{{ moreOthersModalTitle }}"
          resizable="true"
          [breakpoints]="{ '1490px': '90vw' }"
          [contentStyle]="{ height: '60vh' }"
          [modal]="true"
          [style]="{ width: '1340px' }"
          [(visible)]="isMoreOthersModalVisible" >
  <div class="row grid grid-cols-12 gap-4">
    <div style="height: 55vh" class="col-span-12 sm:col-span-4">
      <p-table scrollHeight="flex"
               sortMode="multiple"
               class="p-datatable-sm text-sm"
               [scrollable]="true"
               [value]="genericByNsSummaryDtos" >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="namespaceName" style="width: 50%; max-width: 50%">
              Namespace
              <p-sortIcon field="namespaceName" />
            </th>
            <th pSortableColumn="totalCount" style="width: 25%; max-width: 25%" class="tod-text-right">
              Total
              <p-sortIcon field="totalCount" />
            </th>
            <th pSortableColumn="distinctCount" style="width: 25%; max-width: 25%" class="tod-text-right">
              Distinct
              <p-sortIcon field="distinctCount" />
            </th>
          </tr>
        </ng-template>
        <ng-template let-others pTemplate="body">
          @if (!others.isTotal) {
            <tr>
              <td style="width: 50%; max-width: 50%">{{ others.namespaceName }}</td>
              <td style="width: 25%; max-width: 25%" class="tod-text-right">{{ others.totalCount }}</td>
              <td style="width: 25%; max-width: 25%" class="tod-text-right">{{ others.distinctCount }}</td>
            </tr>
          }
        </ng-template>
        <ng-template pTemplate="footer">
          <tr>
            <td></td>
            <td class="tod-text-right">{{ getFooterData('totalCount') }}</td>
            <td class="tod-text-right">{{ getFooterData('distinctCount') }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <div style="height: 55vh" class="col-span-12 sm:col-span-8">
      <p-table scrollHeight="flex"
               sortMode="multiple"
               class="p-datatable-sm text-sm"
               [scrollable]="true"
               [value]="genericSummaryDtos" >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="name" style="width: 70%; max-width: 70%">
              Name
              <p-sortIcon field="name" />
            </th>
            <th pSortableColumn="count" style="width: 30%; min-width: 20%" class="tod-text-right">
              Count
              <p-sortIcon field="count" />
            </th>
          </tr>
        </ng-template>
        <ng-template let-others pTemplate="body">
          <tr>
            <td style="width: 70%; max-width: 70%">{{ others.name }}</td>
            <td style="width: 30%; max-width: 30%" class="tod-text-right">{{ others.count }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</p-dialog>

<p-dialog closable="true"
          closeOnEscape="true"
          dismissableMask="true"
          header="Vulnerability Reports Details"
          resizable="true"
          [maximizable]="true"
          [contentStyle]="{ height: '70vh' }"
          [modal]="true"
          [style]="{ width: '90vw' }"
          [(visible)]="isMoreVRDetailsModalVisible">
  <p-table class="p-datatable-sm text-sm"
           [scrollable]="true"
           scrollHeight="flex"
           [value]="vrDetailsReportDtos">
    <ng-template pTemplate="header">
      <tr>
        <th pFrozenColumn rowspan="2">Namespace</th>
        @for (id of severityIds; track id) {
          <th colspan="2" class="tod-text-center">{{ id | severityNameById }}</th>
        }
      </tr>
      <tr>
        @for (id of severityIds; track id) {
          <th class="tod-text-center">Count</th>
          <th class="tod-text-center">Fixable</th>
        }
      </tr>
    </ng-template>
    <ng-template let-vrDetailsReportDto pTemplate="body">
      <tr>
        <td pFrozenColumn>{{ vrDetailsReportDto.namespaceName }}</td>
        @for (value of vrDetailsReportDto.values; track $index) {
          <td class="tod-text-center">
            <p-tag [rounded]="true"
                   [style]="value.severityId | severityCssStyleById:value.count"
                   [value]="value.count | vulnerabilityCount" />
          </td>
        }
      </tr>
    </ng-template>
    <ng-template pTemplate="footer">
      <tr>
        <td pFrozenColumn class="font-bold">Total</td>
        @for (value of vrDetailsReportDtoFooter.values; track $index) {
          <td class="tod-text-center">
            <p-tag [rounded]="true"
                   [style]="value.severityId | severityCssStyleById:value.count"
                   [value]="value.count | vulnerabilityCount" />
          </td>
        }
      </tr>
    </ng-template>
  </p-table>
</p-dialog>
