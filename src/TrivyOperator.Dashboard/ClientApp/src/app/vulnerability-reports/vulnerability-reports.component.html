<h3>Vulnerability Reports</h3>

<div #mainContainer id="mainContainer" class="row">
  <div class="grid flex">
    <div #vrMainTableColum id="vrMainTableColum" class="col-4 p-1">
      <app-trivy-table #vrMainTable id="vrMainTable"
                       [dataDtos]="vulnerabilityReportDtos!"
                       [activeNamespaces]="activeNamespaces"
                       [tableColumns]="mainTableColumns"
                       [trivyTableColumns]="mainTrivyTableColumns"
                       [trivyTableOptions]="mainTrivyTableOptions"
                       (selectedRowsChanged)="onSelectionChange($event)"
                       (refreshRequested)="onRefreshRequested($event)"
                       tableHeight="82vh"
                       [isLoading]="isMainTableLoading" />
    </div>

    <div #vrDetailsColumn id="vrDetailsColumn" class="col-8 p-1">
      <p-panel class="row" #vrDetailsPanel id="vrDetailsPanel" header="Vulnerability Reports" [toggleable]="true">
        <p-table id="vrDetailsTable" [value]="detailsKeyValues" styleClass="p-datatable-sm" [style]="{'font-size':'14px', 'width':'100%'}">
          <ng-template pTemplate="body" let-detailsKeyValue>
            <tr>
              <td style="width: 170px; min-width: 170px; height: 50px">
                {{ detailsKeyValue.detailKey }}
              </td>
              <td style="white-space: normal; display: flex; align-items: center; height: 50px;">
                <a>{{ detailsKeyValue.detailValue }}</a>
                <p-button *ngIf="detailsKeyValue.buttonLink" label="{{ detailsKeyValue.buttonLink }}" [text]="true" size="small" (onClick)="onUsedByMore()" />
                <p-tag *ngIf="detailsKeyValue.badge" [value]="detailsKeyValue.badge" severity="info" [style]="{ 'margin-left': '10px', }" />
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-panel>

      <app-trivy-table class="row" 
                       #vrDetailsTable
                       [dataDtos]="selectedVulnerabilityReportDto?.vulnerabilities"
                       [activeNamespaces]="activeNamespaces"
                       [tableColumns]="detailsTableColumns"
                       [trivyTableColumns]="detailsTrivyTableColumns"
                       [trivyTableOptions]="detailsTrivyTableOptions"
                       tableHeight="52vh"
                       [tableHeight]="detailsTableHeight" />
    </div>
  </div>
</div>

<p-dialog *ngIf="selectedVulnerabilityReportDto && selectedVulnerabilityReportDto.resources"
          header="Image Usage for {{ selectedVulnerabilityReportDto.imageName }}:{{ selectedVulnerabilityReportDto.imageTag }} in namespace {{ selectedVulnerabilityReportDto.resourceNamespace }}"
          [modal]="true"
          [(visible)]="isImageUsageDialogVisible"
          closable="true"
          closeOnEscape="true"
          dismissableMask="true"
          resizable="true"
          [contentStyle]="{ 'height': '60vh'}"
          [style]="{ width: '50rem' }">
  <p-table [value]="selectedVulnerabilityReportDto!.resources!"
           [scrollable]="true"
           scrollHeight="flex"
           styleClass="p-datatable-sm"
           [style]="{'font-size':'14px', 'padding':'0rem'}">
    <ng-template pTemplate="header">
      <tr>
        <th style="width:55%">Resource Name</th>
        <th style="width:20%">Kind</th>
        <th style="width:25%">Container</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-resource>
      <tr>
        <td style="width: 55%;">
          {{ resource.name }}
        </td>
        <td style="width: 20%;">
          {{ resource.kind }}
        </td>
        <td style="width:25%;">
          {{ resource.containerName }}
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-dialog>
