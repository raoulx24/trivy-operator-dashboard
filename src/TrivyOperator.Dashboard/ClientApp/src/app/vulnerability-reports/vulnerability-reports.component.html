<h3>Vulnerability Reports</h3>

<div class="row">
  <div class="grid flex">
    <div class="col-12 sm:col-6 md:col-5 lg:col-4 p-1">
      <app-trivy-table #vrMainTable
                       [dataDtos]="vulnerabilityReportDtos!"
                       [activeNamespaces]="activeNamespaces"
                       [tableColumns]="mainTableColumns"
                       [trivyTableColumns]="mainTrivyTableColumns"
                       [trivyTableOptions]="mainTrivyTableOptions"
                       (selectedRowsChanged)="onSelectionChange($event)"
                       (refreshRequested)="onRefreshRequested($event)"
                       tableHeight="82vh"
                       [isLoading]="isMainTableLoading"

                       [trivyExpandTableOptions]="mainTableExpandTableOptions"
                       [trivyExpandTableFunction]="mainTableExpandCellOptions"
                       (trivyDetailsTableCallback)="mainTableExpandCallback($event)"

                       class="trivy-half"/>
    </div>

    <div class="col-12 sm:col-12 md:col-7 lg:col-8 p-1">
      <app-trivy-table class="row" 
                       [dataDtos]="selectedVulnerabilityReportDto?.vulnerabilities"
                       [activeNamespaces]="activeNamespaces"
                       [tableColumns]="detailsTableColumns"
                       [trivyTableColumns]="detailsTrivyTableColumns"
                       [trivyTableOptions]="detailsTrivyTableOptions"
                       tableHeight="82vh" />
    </div>
  </div>
</div>

<p-dialog *ngIf="mainTableExpandCallbackDto && mainTableExpandCallbackDto.resources"
          header="Image Usage for {{ mainTableExpandCallbackDto.imageName }}:{{ mainTableExpandCallbackDto.imageTag }} in namespace {{ mainTableExpandCallbackDto.resourceNamespace }}"
          [modal]="true"
          [(visible)]="isImageUsageDialogVisible"
          closable="true"
          closeOnEscape="true"
          dismissableMask="true"
          resizable="true"
          [contentStyle]="{ 'height': '60vh'}"
          [style]="{ width: '50rem' }">
  <p-table [value]="mainTableExpandCallbackDto!.resources!"
           [scrollable]="true"
           scrollHeight="flex"
           sortMode="multiple"
           styleClass="p-datatable-sm text-sm p-0">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="name" style="width:55%">
          Resource Name
          <p-sortIcon field="name" />
        </th>
        <th pSortableColumn="kind" style="width:20%">
          Kind
          <p-sortIcon field="kind" />
        </th>
        <th pSortableColumn="containerName" style="width:25%">
          Container
          <p-sortIcon field="containerName" />
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-resource>
      <tr>
        <td style="width: 55%;">
          {{ resource.name }}
        </td>
        <td style="width: 20%;">
          {{ resource.kind }}
        </td>
        <td style="width:25%;">
          {{ resource.containerName }}
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-dialog>
